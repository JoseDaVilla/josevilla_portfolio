---
import type { Project } from '../../data/projects';

interface Props {
  projects: Project[];
}

const { projects } = Astro.props;
---

<div id="projectModal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <button class="modal-close" aria-label="Close modal">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    
    <div class="modal-body">
      <!-- Left: Content -->
      <div class="modal-info">
        <div class="modal-header">
          <span class="modal-category"></span>
          <h2 class="modal-title"></h2>
          <p class="modal-description"></p>
        </div>

        <div class="modal-section">
          <h4>Technologies</h4>
          <div class="modal-tech"></div>
        </div>

        <div class="modal-section">
          <h4>Key Features</h4>
          <ul class="modal-features"></ul>
        </div>

        <div class="modal-privacy"></div>

        <div class="modal-actions"></div>
      </div>

      <!-- Right: Preview/Carousel -->
      <div class="modal-preview-container">
        <div class="modal-preview">
          <div class="carousel">
            <div class="carousel-track"></div>
            <button class="carousel-btn carousel-prev" aria-label="Previous">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <button class="carousel-btn carousel-next" aria-label="Next">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
            <div class="carousel-dots"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    overflow-y: auto;
    padding: 2rem 0;
  }

  .modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    z-index: 1;
  }

  .modal-content {
    position: relative;
    background: linear-gradient(to bottom, #ffffff 0%, #fdfbf8 100%);
    max-width: 1200px;
    width: 90%;
    margin: 2rem auto;
    border-radius: 24px;
    box-shadow: 0 30px 90px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.45s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 2;
    max-height: calc(100vh - 4rem);
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.2);
    --modal-accent: #6C5CE7;
  }

  @keyframes modalSlideIn {
    from {
      transform: scale(0.9) translateY(30px);
      opacity: 0;
    }
    to {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
  }

  .modal-close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    background: rgba(26, 26, 26, 0.06);
    border: 1.5px solid rgba(26, 26, 26, 0.08);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: all 0.3s ease;
  }

  .modal-close:hover {
    background-color: rgba(26, 26, 26, 0.1);
    transform: rotate(90deg);
  }

  .modal-body {
    display: grid;
    grid-template-columns: 1fr 480px;
    gap: 3rem;
    padding: 2.5rem;
    align-items: center;
  }

  /* Left: Info Section */
  .modal-info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .modal-header {
    margin-bottom: 0.5rem;
  }

  .modal-category {
    display: inline-block;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--modal-accent);
    background: color-mix(in srgb, var(--modal-accent) 12%, transparent);
    padding: 0.5rem 1rem;
    border-radius: 100px;
    margin-bottom: 1rem;
  }

  .modal-title {
    font-size: 2.25rem;
    font-weight: 800;
    margin-bottom: 0.75rem;
    line-height: 1.15;
    letter-spacing: -0.03em;
    color: #0a0a0a;
  }

  .modal-description {
    font-size: 1rem;
    color: #666;
    line-height: 1.7;
  }

  .modal-section h4 {
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #999;
    margin-bottom: 0.75rem;
  }

  .modal-tech {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  /* Tech tags with icons */
  .modal-tech :global(.tech-tag) {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--modal-accent);
    background: color-mix(in srgb, var(--modal-accent) 12%, transparent);
    padding: 0.4rem 0.85rem;
    border-radius: 100px;
    transition: all 0.2s ease;
  }

  .modal-tech :global(.tech-tag:hover) {
    background: var(--modal-accent);
    color: white;
  }

  .modal-tech :global(.tech-tag:hover svg),
  .modal-tech :global(.tech-tag:hover img) {
    filter: brightness(0) invert(1);
  }

  .modal-tech :global(.tech-icon) {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
    object-fit: contain;
  }

  /* Features in 2-column grid */
  .modal-features {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem 1.5rem;
  }

  .modal-features :global(li) {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    font-size: 0.85rem;
    color: #444;
    line-height: 1.4;
    padding: 0.4rem 0;
  }

  .modal-features :global(li::before) {
    content: '';
    flex-shrink: 0;
    width: 6px;
    height: 6px;
    background: var(--modal-accent);
    border-radius: 50%;
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--modal-accent) 20%, transparent);
  }

  .modal-privacy {
    display: none;
    padding: 1rem 1.25rem;
    background: linear-gradient(135deg, #fffbf0 0%, #fff9e6 100%);
    border-left: 4px solid #ffc107;
    border-radius: 10px;
    font-size: 0.85rem;
    color: #856404;
    font-weight: 500;
    line-height: 1.5;
  }

  .modal-privacy.visible {
    display: block;
  }

  .modal-actions {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
  }

  .modal-actions :global(a) {
    padding: 0.85rem 2rem;
    border-radius: 12px;
    font-weight: 700;
    font-size: 0.9rem;
    text-decoration: none;
    transition: all 0.3s ease;
    text-align: center;
    display: inline-block;
  }

  .modal-actions :global(.btn-primary) {
    background: var(--modal-accent);
    color: white;
    box-shadow: 0 4px 16px color-mix(in srgb, var(--modal-accent) 40%, transparent);
  }

  .modal-actions :global(.btn-primary:hover) {
    transform: translateY(-2px);
    box-shadow: 0 6px 24px color-mix(in srgb, var(--modal-accent) 50%, transparent);
  }

  .modal-actions :global(.btn-secondary) {
    background: transparent;
    color: #0a0a0a;
    border: 2px solid rgba(26, 26, 26, 0.12);
  }

  .modal-actions :global(.btn-secondary:hover) {
    border-color: var(--modal-accent);
    color: var(--modal-accent);
  }

  /* Right: Preview Section */
  .modal-preview-container {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-preview {
    width: 480px;
    height: 480px;
    border-radius: 20px;
    overflow: hidden;
    background: #ffffff;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  }

  .carousel {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #ffffff;
  }

  .carousel-track {
    display: flex;
    height: 100%;
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    background: #ffffff;
  }

  .carousel-track :global(img),
  .carousel-track :global(iframe) {
    min-width: 100%;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: none !important;
    outline: none;
    background: #ffffff;
    display: block;
  }

  .carousel-track :global(iframe) {
    border: 0 !important;
    margin: 0;
    padding: 0;
  }

  .carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.95);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
    z-index: 5;
  }

  .carousel-btn:hover {
    background: #fff;
    transform: translateY(-50%) scale(1.1);
  }

  .carousel-prev { left: 1rem; }
  .carousel-next { right: 1rem; }

  .carousel-btn.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .carousel-dots {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 5;
  }

  .carousel-dots :global(.carousel-dot) {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.3);
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .carousel-dots :global(.carousel-dot.active) {
    background: var(--modal-accent);
    transform: scale(1.2);
  }

  .carousel-track :global(.no-preview-message) {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-width: 100%;
    height: 100%;
    color: #999;
    text-align: center;
    padding: 2rem;
    background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
  }

  .carousel-track :global(.no-preview-message svg) {
    margin-bottom: 1rem;
    opacity: 0.5;
    color: #888;
  }

  .carousel-track :global(.no-preview-message p) {
    font-size: 1rem;
    font-weight: 500;
    color: #888;
  }

  /* Responsive */
  @media (max-width: 1100px) {
    .modal-body {
      grid-template-columns: 1fr 400px;
      gap: 2rem;
    }

    .modal-preview {
      width: 400px;
      height: 400px;
    }
  }

  @media (max-width: 900px) {
    .modal-body {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .modal-preview-container {
      order: -1;
    }

    .modal-preview {
      width: 100%;
      max-width: 450px;
      height: auto;
      aspect-ratio: 1;
      margin: 0 auto;
    }

    .modal-title {
      font-size: 2rem;
    }
  }

  @media (max-width: 640px) {
    .modal {
      padding: 1rem 0;
    }

    .modal-content {
      margin: 1rem;
      width: calc(100% - 2rem);
      border-radius: 20px;
    }

    .modal-body {
      padding: 2rem 1.5rem;
    }

    .modal-close {
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
    }

    .modal-title {
      font-size: 1.75rem;
    }

    .modal-preview {
      max-width: 100%;
    }

    .modal-features {
      grid-template-columns: 1fr;
    }

    .modal-actions {
      flex-direction: column;
    }

    .modal-actions a {
      width: 100%;
    }
  }
</style>

<script is:inline define:vars={{ projectsData: projects }}>
  document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('projectModal');
    const modalOverlay = modal?.querySelector('.modal-overlay');
    const modalClose = modal?.querySelector('.modal-close');
    const viewButtons = document.querySelectorAll('.view-btn');
    
    let currentSlide = 0;
    let totalSlides = 0;

    function initCarousel(images, iframeUrl) {
      const track = modal.querySelector('.carousel-track');
      const dotsContainer = modal.querySelector('.carousel-dots');
      const prevBtn = modal.querySelector('.carousel-prev');
      const nextBtn = modal.querySelector('.carousel-next');
      
      currentSlide = 0;
      
      // Build content - iframe OR images carousel, not both
      let content = '';
      
      if (iframeUrl) {
        // Only show iframe, no carousel
        content = `<iframe src="${iframeUrl}" title="Live Demo" loading="lazy" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope"></iframe>`;
        track.innerHTML = content;
        
        // Hide all carousel controls for iframe
        prevBtn.classList.add('hidden');
        nextBtn.classList.add('hidden');
        dotsContainer.style.display = 'none';
        totalSlides = 1;
        return;
      }
      
      // Show images carousel only if no iframe
      if (images && images.length > 0) {
        images.forEach(img => {
          content += `<img src="${img}" alt="Project screenshot" loading="lazy" onerror="this.parentElement.removeChild(this)" />`;
        });
      }
      
      if (!content) {
        content = `
          <div class="no-preview-message">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
              <line x1="8" y1="21" x2="16" y2="21"></line>
              <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            <p>Preview not available</p>
          </div>
        `;
      }
      
      track.innerHTML = content;
      
      // Count actual slides (images only)
      totalSlides = track.querySelectorAll('img').length;
      
      // Build dots
      let dotsHTML = '';
      for (let i = 0; i < totalSlides; i++) {
        dotsHTML += `<button class="carousel-dot ${i === 0 ? 'active' : ''}" data-index="${i}"></button>`;
      }
      dotsContainer.innerHTML = dotsHTML;
      
      // Hide buttons if only one slide or no slides
      if (totalSlides <= 1) {
        prevBtn.classList.add('hidden');
        nextBtn.classList.add('hidden');
        dotsContainer.style.display = 'none';
      } else {
        prevBtn.classList.remove('hidden');
        nextBtn.classList.remove('hidden');
        dotsContainer.style.display = 'flex';
        updateCarousel();
      }
    }

    function updateCarousel() {
      const track = modal.querySelector('.carousel-track');
      const dots = modal.querySelectorAll('.carousel-dot');
      const prevBtn = modal.querySelector('.carousel-prev');
      const nextBtn = modal.querySelector('.carousel-next');
      
      track.style.transform = `translateX(-${currentSlide * 100}%)`;
      
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === currentSlide);
      });
      
      prevBtn.style.opacity = currentSlide === 0 ? '0.5' : '1';
      nextBtn.style.opacity = currentSlide === totalSlides - 1 ? '0.5' : '1';
    }

    function nextSlide() {
      if (currentSlide < totalSlides - 1) {
        currentSlide++;
        updateCarousel();
      }
    }

    function prevSlide() {
      if (currentSlide > 0) {
        currentSlide--;
        updateCarousel();
      }
    }

    function openModal(projectId) {
      const project = projectsData.find(p => p.id === projectId);
      if (!project || !modal) return;

      // Set accent color
      modal.querySelector('.modal-content').style.setProperty('--modal-accent', project.accentColor);

      // Populate content
      modal.querySelector('.modal-category').textContent = project.category;
      modal.querySelector('.modal-title').textContent = project.title;
      modal.querySelector('.modal-description').textContent = project.description;

      // Tech stack with icons
      const techIcons = {
        'React': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M14.23 12.004a2.236 2.236 0 0 1-2.235 2.236 2.236 2.236 0 0 1-2.236-2.236 2.236 2.236 0 0 1 2.235-2.236 2.236 2.236 0 0 1 2.236 2.236zm2.648-10.69c-1.346 0-3.107.96-4.888 2.622-1.78-1.653-3.542-2.602-4.887-2.602-.41 0-.783.093-1.106.278-1.375.793-1.683 3.264-.973 6.365C1.98 8.917 0 10.42 0 12.004c0 1.59 1.99 3.097 5.043 4.03-.704 3.113-.39 5.588.988 6.38.32.187.69.275 1.102.275 1.345 0 3.107-.96 4.888-2.624 1.78 1.654 3.542 2.603 4.887 2.603.41 0 .783-.09 1.106-.275 1.374-.792 1.683-3.263.973-6.365C22.02 15.096 24 13.59 24 12.004c0-1.59-1.99-3.097-5.043-4.032.704-3.11.39-5.587-.988-6.38-.318-.184-.688-.277-1.092-.278z"/></svg>',
        'Next.js': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M11.572 0c-.176 0-.31.001-.358.007a19.76 19.76 0 0 1-.364.033C7.443.346 4.25 2.185 2.228 5.012a11.875 11.875 0 0 0-2.119 5.243c-.096.659-.108.854-.108 1.747s.012 1.089.108 1.748c.652 4.506 3.86 8.292 8.209 9.695.779.25 1.6.422 2.534.525.363.04 1.935.04 2.299 0 1.611-.178 2.977-.577 4.323-1.264.207-.106.247-.134.219-.158-.02-.013-.9-1.193-1.955-2.62l-1.919-2.592-2.404-3.558a338.739 338.739 0 0 0-2.422-3.556c-.009-.002-.018 1.579-.023 3.51-.007 3.38-.01 3.515-.052 3.595a.426.426 0 0 1-.206.214c-.075.037-.14.044-.495.044H7.81l-.108-.068a.438.438 0 0 1-.157-.171l-.05-.106.006-4.703.007-4.705.072-.092a.645.645 0 0 1 .174-.143c.096-.047.134-.051.54-.051.478 0 .558.018.682.154.035.038 1.337 1.999 2.895 4.361a10760.433 10760.433 0 0 0 4.735 7.17l1.9 2.879.096-.063a12.317 12.317 0 0 0 2.466-2.163 11.944 11.944 0 0 0 2.824-6.134c.096-.66.108-.854.108-1.748 0-.893-.012-1.088-.108-1.747-.652-4.506-3.859-8.292-8.208-9.695a12.597 12.597 0 0 0-2.499-.523A33.119 33.119 0 0 0 11.573 0z"/></svg>',
        'PostgreSQL': '<img class="tech-icon" src="/postgre.svg" alt="PostgreSQL" />',
        'Prisma': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M21.807 18.285L13.553.757a1.324 1.324 0 0 0-1.129-.754 1.31 1.31 0 0 0-1.206.626l-8.952 14.5a1.356 1.356 0 0 0 .016 1.455l4.376 6.778a1.408 1.408 0 0 0 1.58.581l12.703-3.757c.389-.115.707-.39.873-.755s.164-.783-.007-1.146z"/></svg>',
        'Tailwind CSS': '<img class="tech-icon" src="/tailwindcss.svg" alt="Tailwind CSS" />',
        'n8n': '<img class="tech-icon" src="/n8n.svg" alt="n8n" />',
        'Stripe': '<img class="tech-icon" src="/stripe.svg" alt="Stripe" />',
        'Twilio': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.381 0 0 5.381 0 12s5.381 12 12 12 12-5.381 12-12S18.619 0 12 0zm0 2.4c5.302 0 9.6 4.298 9.6 9.6s-4.298 9.6-9.6 9.6S2.4 17.302 2.4 12 6.698 2.4 12 2.4zm-1.2 4.8v4.8H6v2.4h4.8v4.8h2.4v-4.8H18v-2.4h-4.8V7.2h-2.4z"/></svg>',
        'GHL': '<img class="tech-icon" src="/ghl.jpeg" alt="GHL" />',
        'OpenAI': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073z"/></svg>',
        'SendGrid': '<img class="tech-icon" src="/sendgrid.svg" alt="SendGrid" />',
        'Commio': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',
        'Google API': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"/></svg>',
        'Meta API': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.04c-5.5 0-10 4.49-10 10.02 0 5 3.66 9.15 8.44 9.9v-7H7.9v-2.9h2.54V9.85c0-2.51 1.49-3.89 3.78-3.89 1.09 0 2.23.19 2.23.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.45 2.9h-2.33v7a10 10 0 0 0 8.44-9.9c0-5.53-4.5-10.02-10-10.02z"/></svg>',
        'PayArc': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>',
        'Three.js': '<img class="tech-icon" src="/Three.js_light.svg" alt="Three.js" />',
        'Blender': '<img class="tech-icon" src="/blender.svg" alt="Blender" />',
        'GLSL Shaders': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0L1.5 6v12L12 24l10.5-6V6L12 0zm0 2.31l7.5 4.31v8.76L12 19.69l-7.5-4.31V6.62L12 2.31z"/></svg>',
        'WebGL': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0L1.5 6v12L12 24l10.5-6V6L12 0zm0 2.31l7.5 4.31v8.76L12 19.69l-7.5-4.31V6.62L12 2.31z"/></svg>',
        'JavaScript': '<img class="tech-icon" src="/javascript.svg" alt="JavaScript" />',
        'Python': '<img class="tech-icon" src="/python.svg" alt="Python" />',
        'Express.js': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M24 18.588a1.529 1.529 0 0 1-1.895-.72l-3.45-4.771-.5-.667-4.003 5.444a1.466 1.466 0 0 1-1.802.708l5.158-6.92-4.798-6.251a1.595 1.595 0 0 1 1.9.666l3.576 4.83 3.596-4.81a1.435 1.435 0 0 1 1.788-.668L21.708 7.9l-2.522 3.283a.666.666 0 0 0 0 .994l4.804 6.412z"/></svg>',
        'Chart.js': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 20V4M18 20V10M6 20v-6"/></svg>',
        'JWT': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M10.2 0v6.456L12 9.778l1.8-3.322V0h-3.6zM6.456 1.14L4.562 7.18l3.322 1.8 1.8-3.322-3.228-4.52zM17.544 1.14l-3.228 4.52 1.8 3.322 3.322-1.8-1.894-6.042z"/></svg>',
        'Cloudinary': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4c4.41 0 8 3.59 8 8s-3.59 8-8 8-8-3.59-8-8 3.59-8 8-8m0-2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg>',
        'Ringba': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 0 0-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/></svg>',
        'Alpaca API': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>',
        'EODHD API': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg>',
        'Pandas': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M16.922 0h2.623v18.104h-2.623zm-4.126 12.94h2.623v2.57h-2.623zm0-7.037h2.623v5.446h-2.623zm0 11.197h2.623v5.446h-2.623zM4.456 5.896h2.622V24H4.456zm4.213 2.559h2.623v2.57H8.67zm0 4.151h2.623v5.447H8.67zm0-9.9h2.623v5.446H8.67z"/></svg>',
        'NumPy': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M10.315 4.876L6.098 2.753.842 5.418v11.209l5.256 2.665 4.217-2.123v5.831l5.256 2.665 5.256-2.665V11.791l-5.256-2.665-4.217 2.123V5.418l-.039.02v-.562z"/></svg>',
        'Matplotlib': '<svg class="tech-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M3 3v18h18V3H3zm15 15H6V6h12v12z"/></svg>'
      };

      const techContainer = modal.querySelector('.modal-tech');
      techContainer.innerHTML = project.technologies.map(tech => {
        const icon = techIcons[tech] || '';
        return `<span class="tech-tag">${icon}${tech}</span>`;
      }).join('');

      // Features as bullet points
      const featuresContainer = modal.querySelector('.modal-features');
      featuresContainer.innerHTML = project.features.map(feature => 
        `<li>${feature}</li>`
      ).join('');

      // Privacy note
      const privacyContainer = modal.querySelector('.modal-privacy');
      if (project.privacyNote) {
        privacyContainer.textContent = project.privacyNote;
        privacyContainer.classList.add('visible');
      } else {
        privacyContainer.classList.remove('visible');
      }

      // Actions
      const actionsContainer = modal.querySelector('.modal-actions');
      let actionsHTML = '';
      
      if (project.viewUrl) {
        actionsHTML += `<a href="${project.viewUrl}" target="_blank" rel="noopener noreferrer" class="btn-primary">Live Demo</a>`;
      }
      
      if (project.githubUrl) {
        actionsHTML += `<a href="${project.githubUrl}" target="_blank" rel="noopener noreferrer" class="btn-secondary">View on GitHub</a>`;
      }
      
      if (!actionsHTML) {
        actionsHTML = '<span style="color:#999;font-size:0.9rem;padding:0.5rem 0;">Contact for access</span>';
      }
      
      actionsContainer.innerHTML = actionsHTML;

      // Initialize carousel
      initCarousel(project.images || [], project.iframeUrl);

      // Show modal
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      if (!modal) return;
      modal.classList.remove('active');
      document.body.style.overflow = '';
      
      // Clear iframe to stop any media
      const track = modal.querySelector('.carousel-track');
      if (track) track.innerHTML = '';
    }

    // Event listeners
    viewButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent card click
        const projectId = parseInt(button.getAttribute('data-project-id'));
        openModal(projectId);
      });
    });

    // Make entire project card clickable (supports both old and bento cards)
    const projectCards = document.querySelectorAll('.project[data-project-id], .bento-card[data-project-id]');
    projectCards.forEach(card => {
      card.addEventListener('click', (e) => {
        // Don't open modal if clicking on GitHub link or action buttons
        if (e.target.closest('.github-btn') || e.target.closest('a[href]')) {
          return;
        }
        const projectId = parseInt(card.getAttribute('data-project-id'));
        openModal(projectId);
      });
    });

    if (modalClose) modalClose.addEventListener('click', closeModal);
    if (modalOverlay) modalOverlay.addEventListener('click', closeModal);

    // Carousel controls
    modal?.querySelector('.carousel-prev')?.addEventListener('click', prevSlide);
    modal?.querySelector('.carousel-next')?.addEventListener('click', nextSlide);
    
    modal?.querySelector('.carousel-dots')?.addEventListener('click', (e) => {
      if (e.target.classList.contains('carousel-dot')) {
        currentSlide = parseInt(e.target.dataset.index);
        updateCarousel();
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!modal?.classList.contains('active')) return;
      
      if (e.key === 'Escape') closeModal();
      if (e.key === 'ArrowLeft') prevSlide();
      if (e.key === 'ArrowRight') nextSlide();
    });
  });
</script>
